<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: worker-pool.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: worker-pool.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>'use strict';
/**
 * Created by jalal on 30/03/14.
 */


/**
 * @class Async.WorkerPool
 * @classdesc WorkerPool is a class to manage a pool of worker and dispatch the task to a worker
 */
Async.WorkerPool = (function(nbWorker, asyncScript)
{
    /**
     * @instance
     * @public
     * @memberof Async.WorkerPool
     * @desc worker array is stored the Async.Worker
     * @type {Array}
     * @private
     */
    var _workers = [];

    if (nbWorker === 0)
    {
        throw {msg : 'Cannot create worker pool with 0 thread'};
    }
    for (var i = 0; i &lt; nbWorker; i++)
    {
        _workers.push(new Async.Worker(asyncScript));
    }

    /**
     * @memberof Async.WorkerPool
     * @private
     * @instance
     * @desc get a worker(the least loaded)
     * @method getWorker
     * @returns {Async.Worker}
     */
    var getWorker = function()
    {
        var lessWorker = _workers[0];

        _workers.forEach(function(worker)
        {
           if (worker.getNbTask() &lt; lessWorker.getNbTask() && worker.isDedicated === false)
           {
               lessWorker = worker;
           }
        });
        if (lessWorker.isDedicated)
        {
            return null;
        }
        return lessWorker;
    };

    return {
        /**
         * @instance
         * @public
         * @memberof Async.WorkerPool
         * @method importScript
         * @desc import a script for all worker in worker pool
         * @param {String} scriptFile
         */
        importScript : function(scriptFile)
        {
            var msg = {
                eventName : 'importScript',
                file : scriptFile
            };

            _workers.forEach(function(worker)
            {
                worker.emit(msg);
            });
        },
        /**
         * @instance
         * @public
         * @memberof Async.WorkerPool
         * @method post
         * @throw {Object} if all worker are busy by infinite task the method throw an exception
         * @desc post a task to a worker in the worker pool
         * @param {Async.Task|Function} task
         * @returns {Async.Task} the task you have posted
         */
        post : function(isInfinite, task)
        {
            var parameters;
            var worker = getWorker();

            if (worker === null)
            {
                throw {msg : "All worker are dedicated to a infinite task"};
            }
            if (arguments.length > 2)
            {
                parameters = Array.prototype.slice.call(arguments, 1, arguments.length);
            }
            if (isInfinite === true)
            {
                worker.isDedicated = true;
            }
            return worker.post(task, parameters);
        },
        /**
         * @instance
         * @public
         * @memberof Async.WorkerPool
         * @method terminate
         * @desc terminate all worker in worker pool
         */
        terminate : function(){
            _workers.forEach(function(worker)
            {
               worker.terminate();
            });
            _workers = [];
        }
    };
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Async.Events.html">Events</a></li><li><a href="Async.Task.html">Task</a></li><li><a href="Async.ThreadTask.html">ThreadTask</a></li><li><a href="Async.Timer.html">Timer</a></li><li><a href="Async.Worker.html">Worker</a></li><li><a href="Async.WorkerPool.html">WorkerPool</a></li></ul><h3>Namespaces</h3><ul><li><a href="global.html#Async">Async</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Sat Apr 05 2014 15:44:52 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
