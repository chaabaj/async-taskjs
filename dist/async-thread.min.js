
/*
 * -------------------------------------------------------
 * Project: AsyncTask
 * Version: 0.1.0
 *
 * Author:  Jalal Chaabane
 * Site:     
 * Contact: jalal.chaabane@gmail.com
 *
 *
 * Copyright (c) 2014 Jalal Chaabane
 * -------------------------------------------------------
 */

var Async={};Async.currentTask=null,Async.ThreadTask=function(task){var _listeners={},_self;return _self={emit:function(eventName){var msg={eventName:eventName,data:Array.prototype.slice.call(arguments,1,arguments.length)};postMessage(msg)},receiveMsg:function(msg){var event=_listeners[msg.eventName];"undefined"!=typeof event&&event.forEach(function(callback){callback.apply(callback,[msg].concat(msg.data))})},on:function(eventName,callback){var event=_listeners[eventName];"undefined"!=typeof event?event.push(callback):_listeners[eventName]=[callback]},execute:function(){var msg,result;eval("var fn="+task.code+";"),result=fn.apply(fn,[_self].concat(task.params)),msg={eventName:"onTaskDone",result:result},postMessage(msg)}}},onmessage=function(evt){var msg=evt.data;"postTask"===msg.eventName?(Async.currentTask=new Async.ThreadTask(evt.data),Async.currentTask.execute()):null!==Async.currentTask&&Async.currentTask.receiveMsg(evt.data)};